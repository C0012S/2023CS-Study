# 프로세스 주소 공간

> 프로세스가 실행 중에 접근할 수 있도록 허용된 주소의 최대범위
> 

![Untitled](https://blog.kakaocdn.net/dn/5JmVp/btrc1UG1Pcu/KLO84wH2FUYp3jyLmtVNc0/img.png)
## 구성 요소

> Code, Data, Stack, Heap
> 

### Code(Text) 영역

- 작성한 **소스코드**가 있는 부분
- CPU가 해석 가능한 기계어 코드가 저장되어 있다
- 실행 파일을 구성하는 명령어들이 올라가는 메모리 영역으로 **함수**, **제어문**, **상수** 등이 여기에 지정
- 컴파일 시점에 결정되며 중간에 코드를 바꿀 수 없도록 **Read-Only**로 되어있다


### Data 영역

- 프로그램의 **전역 변수**와 **Static 변수**가 저장되는 영역
- 프로그램이 사용할 수 있는 데이터를 저장하는 영역
- 전역변수, static 값을 참조한 코드는 컴파일 하고 나면 Data 영역의 주소 값을 가리키도록 바뀜
- 프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸
- 실행 도중에 전역변수가 변경될 수도 있으므로 **Read-Write**로 지정되어 있다

**BSS(Block Stated Symbol) 영역**

- 초기 값이 없는 전역 변수, 배열, static 변수가 저장되는 영역
- 초기화된 데이터는 Data 영역에 저장되고, 초기화 되지 않은 데이터는 BSS 영역에 저장

*Data 영역과 BSS를 나누는 이유?*

초기화 되지 않은 변수는 프로그램이 실행될 때 영역만 잡아주면 되고, 그 값을 프로그램에 저장하고 있을 필요는 없으나, 초기화가 되는 변수는 그 값도 프로그램에 저장하고 있어야 하기 때문
따라서 BSS 영역 변수들이 많아져도 프로그램의 실행 코드 사이즈를 늘리지 않는

</aside>

### Stack 영역

- 함수의 호출과 관계되는 **지역변수**와 **매개변수**가 저장되는 영역
- Stack은 함수의 호출과 함께 할당되며 함수의 호출이 완료되면 소멸
- 원시 타입의 데이터가 값과 함께 할당
- Heap 영역에 생성된 Object 타입의 데이터 참조 값이 할당
- 메모리의 높은 주소에서 낮은 주소로 할당
    - 프로그램이 실행 되며 메모리를 얼마나 사용할 지 미리 계산할 수 없다
    - stack 함수의 뒷부분에서 변수의 주소가 매겨진다
    - 변수 선언 순서에 다라 높은 주소에서 낮은 주소로 내려간다
- **컴파일 시점**에 크기가 결정되기 때문에 무한히 할당할 수 없다
    - 재귀 함수가 너무 깊게 호출되거나 함수가 지역 변수를 너무 많이 가지고 있어 stack 영역을 초과 하면  stack overflow 에러가 발생

### Heap 영역

- **런타임 시점**에 크기 결정
- 사용자에 의해 **공간이 동적으로 할당 및 해제** 된다
- 주로 **참조형 데이터**(ex: class) 등의 데이터가 할당
- 메모리의 낮은 주소에서 높은 주소의 방향으로 할당

## 구역을 나눈 이유

- 최대한 데이터를 공유하여 메모리 사용량을 줄이기 위함

### Code 영역을 따로 둔 이유

- 프로그램의 code는 프로그램이 만들어지고(컴파일되고) 나서는 바뀔 일이 전혀 없음
- 그렇기 때문에 같은 프로그램을 실행 시켜 몇 개의 프로세스가 실행되더라도 같은 프로그램이라면 코드 부분은 다 똑같은 내용을 가지고 있음
- 따라서 같은 프로그램의 프로세스일 경우 코드 부분을 공유하여 메모리 사용량을 줄이기 위한 목적

### Stack과 Data 영역을 나눈 이유

**역할의 분배**

- Stack 영역을 통해 함수의 흐름 관리
- Data영역을 통해 전역 변수, static 변수 관리
- 전역 변수는 어떤 함수에서도 접근할 수 있기 때문에 Data영역에서 따로 관리
    - 메모리를 아낄 수 있다

**Data 영역의 공유**

- 각각의 스레드는 Stack 영역을 갖긴 하지만 Data 영역은 공유한다
- 즉, 각각의 스레드가 사용하기 위해 Data 영역의 동일한 내용을 공유함으로써, 똑같은 공간을 여러개 만들지 않고 메모리를 절약할 수 있다

# 예상 질문

### 1. 각 영역의 크기가 결정되는 시점이 언제?

- code: 컴파일
- data: 컴파일
- stack: 컴파일
- heap: 런타임

### 2. Stack과 Data를 나눈 이유

- 스택 구조의 특성과 전역 변수의 활용성을 위한 것
- 프로그램의 함수와 지역변수는 LIFO 특성을 가진 스택에서 실행되는데. 이 함수들 안에서 공통으로 사용되는 전역 함수는 따로 지정해주면 메모리를 아낄 수 있다

**참고**

[[운영체제] 프로세스 주소 공간](https://yaelimeee.tistory.com/47)

[🚪 프로세스 주소 공간에 대해 설명해주세요](https://seongeun-it.tistory.com/181)

[[운영체제] 프로세스 주소 공간](https://velog.io/@klm03025/운영체제-프로세스-주소-공간)
