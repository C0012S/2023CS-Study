# 💡세마포어(Semaphore) & 뮤텍스(Mutex)

프로세스 간 메시지를 전송하거나 공유 메모리를  통해 공유된 자원에 여러 개의 프로세스가 동시에 접근하면 임계 구역 문제가 발생할 수 있음

이를 해결하기 위해 데이터를 한 번에 하나의 프로세스만 접근할 수 있도록 제한을 두는 동기화 방식 필요



### ❓임계 구역

- 작업들이 자원을 같이 사용할 수 있는 공유 자원이 있는 곳
- 한 작업이 자원을 점유하면 다른 작업은 점유한 작업이 종료 될 때 까지 기다려야 한다

# ✅ 세마포어(Semaphore)

- 데이크스트라가 제안한 알고리즘
- 소프트웨어 상에서 임계 구역 문제를 해결하기 위한 동기화 도구
- 멀티 프로그래밍 환경에서 공유된 자원에 대한 접근을 제한하는 방법

- 임계구역에 진입하기 전에 스위치를 사용 중으로 놓고 임계구역에 들어감
- 이후에 도착하는 프로세스는 앞의 프로세스가 작업을 마칠 때 까지 기다림
- 프로세스가 작업을 마치면 세마포어는 다음 프로세스에 임계구역을 사용하라는 동기화 신호를 보낸다
- 다른 알고리즘과 달리 임계구역이 잠겼는지 직접 점검하거나, 바쁜 대기를 하거나, 다른 프로세스에 동기화 메세지를 보낼 필요가 없다

## 특징

- 공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 접근 가능
- 각 프로세스는 세마포어의 값을 확인하고 변경할 수 있다
- 자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용
- 이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면, 재시도 전에 일정시간 대기해야 한다
- 세마포어를 사용하는 프로세스는 그 값을 확인하고, 자원을 사용하는 동안에는 그 값을 변경함으로써 다른 세마포어 사용자들이 대기하도록 해야 한다
- 세마포어는 이진수를 사용하거나 추가적인 값을 가질 수 있다.

## 종류

### 카운팅 세마포어

- 가능한 개수를 가진 자원에 대한 접근 제어용으로 사용
- 세마포어는 그 가용 가능한 자원의 개수로 초기화
- 자원을 사용하면 세마포어가 감소, 방출하면 증가

### 이진 세마포어

- MUTEX 라고도 부름
- 0과 1 사이의 값만 가능
- 다중 프로세스들 사이의 임계 구역 문제를 해결하기 위해 사용

## 바쁜 대기

### Spin lock

- 세마포어의 초기 버전
- 임계 구역에 진입이 가능할 때까지 루프를 돌면서 재시도하는 방식
- 이 때 바쁜 대기(Busy Waiting) 발생
- 일반적으로는 세마포어에서 임계영역에 진입을 시도했지만 실패한 프로세스에 대해 Block시킨 뒤, 임계영역에 자리가 날 때 다시 깨우는 방식을 사용
    - 바쁜 대기로 인한 시간 낭비 문제 해결

# ✅ 뮤텍스(Mutex)

- 멀티 프로그래밍에서 공유가 불가능한 자원의 동시 사용을 피하기 위한 알고리즘
- 임계 영역을 가진 스레드들의 실행시간이 서로 겹치지 않고 각각 단독으로 실행(상호배제) 되도록 하는 기술
- 한 프로세스에 의해 소유될 수 있는 key를 기반으로 한 상호 배제 기법
    - Key에 해당하는 어떤 객체(Object)가 있으며, 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근 가능

- 다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(Synchronization) 또는 락(Lock)을 사용
- 즉, 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다

# 세마포어와 뮤텍스의 차이점

1. 동기화 대상의 개수
    - 뮤텍스는 동기화 대상이 1개 일 때만 사용
    - 세마포어는 동기화 대상이 1개 이상일 때 사용
    - 세마포어는 뮤텍스가 될 수 있지만 뮤텍스는 세마포어가 될 수 없다
2. 뮤텍스는 자원 소유가 가능하고, 책임을 가지는 반면, 세마포어는 자원 소유 불가
3. 해제 가능한 스레드
    - 뮤텍스는 소유하고 있는 스레드만이 뮤텍스 해제 가능
    - 반면 세마포어는 세마포어를 소유하지 않는 스레드가 세마포어를 해제할 수 있다
4. 세마포어는 시스템 범위에 걸쳐 있고, 파일 시스템 상의 파일로 존재하지만 뮤텍스는 프로세스의 범위를 가지며 프로세스가 종료될 때 자동으로 clean up

# 질문

### **뮤텍스(Mutex)와 세마포어(Semaphore)의 차이에 대해 설명해주세요.**

뮤텍스는 Lock을 사용해 하나의 프로세스나 쓰레드를 단독으로 실행하게 합니다.반면에 세마포어는 공유자원에 세마포어 변수만큼의 프로세스(또는 쓰레드)가 접근할 수 있습니다.

세마포어의 변수 → 공유자원의 개수를 나타내는 변수

현재 수행중인 프로세스가 아닌 다른 프로세스가 세마포어를 해제할 수 있습니다.

하지만 뮤텍스는 락(lock)을 획득한 프로세스가 반드시 그 락을 해제해야 합니다.

0과 1의 값만 갖는 세마포어 →

**이진 세마포어(binary semaphore) (= 뮤텍스)**

도메인 제한이 없는 세마포어(0,1 뿐만아니라 2,3,4 등의 값들 또한 가질 수 있는) →

**카운팅 세마포어(counting semaphore)**

### 세마포어의 장점은 무엇인가요?

- 세마포어는 여러 개의 스레드가 동시에 접근할 수 있도록 제한된 개수만큼만 접근이 가능하게 해주기 때문에, 리소스 활용도가 높습니다. 또한, 세마포어는 뮤텍스보다 복잡한 동기화 문제를 해결할 수 있습니다.

**참고**

[[OS] 뮤텍스(Mutex)와 세마포어(Semaphore)란?](https://chelseashin.tistory.com/40)

[스핀락(Spin lock), 뮤텍스(Mutex), 세마포어(Semaphore) 알아보기](https://yoongrammer.tistory.com/63)

[[ 기술면접 / 운영체제] 세마포어(Semaphore) & 뮤텍스(Mutex)](https://jokerkwu.tistory.com/126)
