# 스레드

> 프로세스 내에서 실제로 작업을 수행하는 주체
> 
- 모든 프로세스에는 한 개 이상의 스레드가 존재하여 작업을 수행
- 두 개 이상의 스레드를 가지는 프로세스를 멀티 프로세스라고 한다
- 스레드란 곧 프로세스를 실행하는 주체
- 보통 가벼운 프로세스(light-process)라고 표현한다
    - 프로세스 생성에 비해 생성 시간이 더 빠르기 때문
    - 스레드 간에 프로세스 자원을 공유할 수 있음
    - 스라드 간의 통신이 용이

## 스레드가 필요한 이유

- 여러개의 작업 단위로 구성된 프로그램에서 동시에 처리하기 위함

## 스레드의 장점

- 스레드는 하나의 프로세스 내의 자원(코드, 데이터, 힙)을 공유하기 때문에 프로세스에 비해 자원 할당 비용이 적게 들고 문맥 교환 비용도 적게 든다
- 다중 스레드의 경우 일부 스레드의 처리가 지연되더라도 다른 스레드에서 작업을 계속 처리할 수 있음
- 프로세스 간의 통신을 IPC가 필요한 반면, 스레드는 공유(데이터, 힙) 주소 공간을 사용하여 데이터를 교환할 수 있음
- 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어 자원을 효율적으로 관리

## 스레드의 단점

- 하나의 스레드에서 발생한 문제가 프로세스 전반에 영향을 미칠 수 있음
- 자원을 공유하기 때문에 동기화 문제가 발생할 수 있음

## 스레드의 유형

### 커널 수준 스레드(1:1 매핑 방식)

![Untitled](https://blog.kakaocdn.net/dn/Sc4OP/btrAVtAl4C2/DQVavAV6XEIi368VhfzEzk/img.png)

- 스레드를 OS(커널)이 직접 관리

**장점**

- 커널이 각 스레드를 개별적으로 관리
- 프로세스 내 스레드들이 병행 수행 가능
- 하나의 스레드가 block되어도 다른 스레드는 계속 작업 가능

**단점**

- 커널 영역에서 스레드의 생성 및 관리
- 문맥 교환으로 인한 오버헤드가 큼
- 사용자 스레드보다 생성 및 관리 속도가 느림

### 사용자 수준 스레드(N:1 매핑)

![Untitled](https://blog.kakaocdn.net/dn/5f3OL/btrAYudzA4x/WGtSVkdwKeTRyoVEGWZ2Sk/img.png)
- 사용자 영역의 스레드 라읻브러리로 구현하며, 라이브러리는 스레드의 생성, 스케줄링을 담당
- 커널은 스레드의 존재를 인식하지 못하기 때문에 커널의 개입을 받지 않는다

**장점**

- 커널의 개입을 받지 않아 스레드의 생성 및 관리의 부하가 적음
- 동일한 메모리 영역에서 스레드가 생성 및 관리 되므로 속도가 빠름
- 라이브러리를 통한 이식성이 높음

**단점**

- 커널은 프로세스 단위로 자원을 할당하기 때문에 하나의 스레드가 block 될 시 모든 스레드가 대기해야 한다
    - 커널이 프로세스 내부 스레드를 인식하지 못하여 해당 프로세스를 대기 상태로 전환시키기 때문

### 혼합 스레드(N:M 매핑 방식)

![혼합스레드](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fb20vhF%2FbtrAR8ihyMI%2FH0pIdFlMu98kktYcGxkQ6K%2Fimg.png)
- 사용자 수준 스레드와 커널 수준 스레드를 혼합한 구조
- 일대일 방식과 다대일 방식의 문제점을 해결하기 위해 고안

**장점**

- 프로세스 내 스레드들이 병행 수행 가능
- 사용자는 원하는 수만큼 스레드 사용
- 효율적이면서도 유연함
- 스레드 풀링 기법을 통해 일대일 스레드 매핑에서의 오버헤드를 줄여줌

## 스레드 풀링

- 시스템이 관리하는 스레드의 풀을 응용프로그램에 제공하여 스레드를 효율적으로 사용할 수 있게 하는 방법
- 미리 생성한 스레드를 재사용하여 스레드를 생성하는 시간을 줄여 시스템의 부담을 덜어준다
- 동시에 생성할 수 있는 스레드 수를 제한하여 시스템의 자원 소비를 줄여서 응용프로그램의 전체 성능을 일정 수준으로 유지

**참고**

[스레드(Thread) 알아보기](https://yoongrammer.tistory.com/55)

[[OS] 스레드(Thread)란?](https://cocoon1787.tistory.com/849)
